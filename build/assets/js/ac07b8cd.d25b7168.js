"use strict";(self.webpackChunkhackathon_book=self.webpackChunkhackathon_book||[]).push([[63],{575(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"module-1/communication","title":"Chapter 2: ROS 2 Communication \u2014 Nodes, Topics, and Services","description":"Learning Objectives","source":"@site/docs/module-1/01-communication.md","sourceDirName":"module-1","slug":"/module-1/communication","permalink":"/hackathon-book/docs/module-1/communication","draft":false,"unlisted":false,"editUrl":"https://github.com/anthropics/hackathon-book/tree/main/docs/module-1/01-communication.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 1: Introduction to ROS 2","permalink":"/hackathon-book/docs/module-1/intro"},"next":{"title":"Chapter 3: Python AI Agents & URDF","permalink":"/hackathon-book/docs/module-1/python-agents"}}');var i=s(4848),o=s(8453);const t={},l="Chapter 2: ROS 2 Communication \u2014 Nodes, Topics, and Services",a={},c=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Core Concepts",id:"core-concepts",level:2},{value:"What is a Node?",id:"what-is-a-node",level:3},{value:"Node Namespaces and Naming",id:"node-namespaces-and-naming",level:3},{value:"Node Lifecycle",id:"node-lifecycle",level:3},{value:"Topics and Publish-Subscribe (Pub-Sub) Communication",id:"topics-and-publish-subscribe-pub-sub-communication",level:2},{value:"What is a Topic?",id:"what-is-a-topic",level:3},{value:"Pub-Sub Communication Flow",id:"pub-sub-communication-flow",level:3},{value:"Message Types and Examples",id:"message-types-and-examples",level:3},{value:"<strong>sensor_msgs/JointState</strong>",id:"sensor_msgsjointstate",level:4},{value:"<strong>geometry_msgs/Twist</strong>",id:"geometry_msgstwist",level:4},{value:"<strong>sensor_msgs/Image</strong>",id:"sensor_msgsimage",level:4},{value:"<strong>geometry_msgs/PoseStamped</strong>",id:"geometry_msgsposestamped",level:4},{value:"Quality of Service (QoS) Policies",id:"quality-of-service-qos-policies",level:3},{value:"<strong>Reliability Policy</strong>",id:"reliability-policy",level:4},{value:"<strong>Durability Policy</strong>",id:"durability-policy",level:4},{value:"<strong>History Policy</strong>",id:"history-policy",level:4},{value:"Topic Naming Conventions",id:"topic-naming-conventions",level:3},{value:"Services and Request-Reply Communication",id:"services-and-request-reply-communication",level:2},{value:"What is a Service?",id:"what-is-a-service",level:3},{value:"Service Request-Reply Patterns",id:"service-request-reply-patterns",level:3},{value:"<strong>Pattern 1: Query Information</strong>",id:"pattern-1-query-information",level:4},{value:"<strong>Pattern 2: Perform an Action</strong>",id:"pattern-2-perform-an-action",level:4},{value:"<strong>Pattern 3: Enable/Disable Functionality</strong>",id:"pattern-3-enabledisable-functionality",level:4},{value:"Service Definition Example",id:"service-definition-example",level:3},{value:"When to Use Services vs. Topics",id:"when-to-use-services-vs-topics",level:3},{value:"Practical Context: Communication in Humanoid Robots",id:"practical-context-communication-in-humanoid-robots",level:2},{value:"Example 1: Obstacle Detection Pipeline",id:"example-1-obstacle-detection-pipeline",level:3},{value:"Example 2: Grasp Command Pipeline",id:"example-2-grasp-command-pipeline",level:3},{value:"Example 3: Motor Feedback Loop",id:"example-3-motor-feedback-loop",level:3},{value:"Communication Patterns in Humanoids",id:"communication-patterns-in-humanoids",level:2},{value:"Pattern 1: Perception \u2192 Planning \u2192 Action",id:"pattern-1-perception--planning--action",level:3},{value:"Pattern 2: Multi-Agent Coordination",id:"pattern-2-multi-agent-coordination",level:3},{value:"Pattern 3: Hierarchical Control with Mode Switching",id:"pattern-3-hierarchical-control-with-mode-switching",level:3},{value:"Edge Cases and Synchronization",id:"edge-cases-and-synchronization",level:2},{value:"Challenge 1: Node Failures and Recovery",id:"challenge-1-node-failures-and-recovery",level:3},{value:"Challenge 2: Message Delays and Out-of-Order Delivery",id:"challenge-2-message-delays-and-out-of-order-delivery",level:3},{value:"Challenge 3: Conflicting Commands (Multi-Agent Coordination)",id:"challenge-3-conflicting-commands-multi-agent-coordination",level:3},{value:"Challenge 4: Latency-Critical Tasks",id:"challenge-4-latency-critical-tasks",level:3},{value:"Challenge 5: Bandwidth Constraints",id:"challenge-5-bandwidth-constraints",level:3},{value:"Summary",id:"summary",level:2},{value:"Review Questions",id:"review-questions",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"chapter-2-ros-2-communication--nodes-topics-and-services",children:"Chapter 2: ROS 2 Communication \u2014 Nodes, Topics, and Services"})}),"\n",(0,i.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,i.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Explain the role of nodes, topics, and services"})," in ROS 2's distributed communication architecture"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Design communication topologies"})," that connect perception, planning, and action subsystems in humanoid robots"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Distinguish between topics (pub-sub) and services (request-reply)"})," and apply each pattern appropriately"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Trace message flow"})," through multi-node systems to diagnose communication bottlenecks"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Apply Quality-of-Service (QoS) policies"})," to ensure reliable message delivery for time-critical robot control"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Handle edge cases"})," such as node failures, message delays, and multi-agent coordination conflicts"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,i.jsx)(n.h3,{id:"what-is-a-node",children:"What is a Node?"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"ROS 2 node"})," is an autonomous computational unit in the ROS 2 graph. Every node is a separate process (or thread) that:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Runs continuously, processing data and making decisions"}),"\n",(0,i.jsx)(n.li,{children:"Communicates with other nodes via topics (publish-subscribe) and services (request-reply)"}),"\n",(0,i.jsxs)(n.li,{children:["Has a unique name within the ROS 2 network (e.g., ",(0,i.jsx)(n.code,{children:"/robot_controller"}),", ",(0,i.jsx)(n.code,{children:"/obstacle_detector"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Follows a standardized lifecycle: UNCONFIGURED \u2192 INACTIVE \u2192 ACTIVE \u2192 FINALIZED"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Real-world analogy"}),": In a humanoid robot's nervous system, each node is like a specialized neural cluster\u2014the perception cluster processes sensor data, the planning cluster reasons about actions, and the motor control cluster executes commands. These clusters communicate via standardized pathways (topics and services)."]}),"\n",(0,i.jsx)(n.h3,{id:"node-namespaces-and-naming",children:"Node Namespaces and Naming"}),"\n",(0,i.jsxs)(n.p,{children:["ROS 2 uses ",(0,i.jsx)(n.strong,{children:"namespaces"})," to organize nodes hierarchically. For example:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/robot_1/arm_controller"})," \u2014 A specific controller in the robot_1 namespace"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/robot_1/perception/obstacle_detector"})," \u2014 Nested namespace for perception subsystems"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/robot_2/arm_controller"})," \u2014 Same node name in a different robot's namespace (multi-agent coordination)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Naming conventions"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"snake_case"})," for node names (e.g., ",(0,i.jsx)(n.code,{children:"joint_trajectory_controller"}),", ",(0,i.jsx)(n.code,{children:"grasping_planner"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Use hierarchical namespaces to group related nodes (e.g., ",(0,i.jsx)(n.code,{children:"/robot/arm/"}),", ",(0,i.jsx)(n.code,{children:"/robot/legs/"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Avoid hardcoded node names; use configuration files to support dynamic deployment"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"node-lifecycle",children:"Node Lifecycle"}),"\n",(0,i.jsx)(n.p,{children:"Every ROS 2 node transitions through four states:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"UNCONFIGURED \u2192 INACTIVE \u2192 ACTIVE \u2192 FINALIZED\r\n     \u2191                                    \u2193\r\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"UNCONFIGURED"}),": Node initialized but not yet ready (resources not allocated)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"INACTIVE"}),": Node configured but paused (ready to activate on demand)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ACTIVE"}),": Node running, publishing/subscribing, processing messages"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"FINALIZED"}),": Node shut down, resources released"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This lifecycle ensures graceful startup and shutdown\u2014critical for multi-node robot systems where components must be activated in dependency order."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"topics-and-publish-subscribe-pub-sub-communication",children:"Topics and Publish-Subscribe (Pub-Sub) Communication"}),"\n",(0,i.jsx)(n.h3,{id:"what-is-a-topic",children:"What is a Topic?"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"topic"})," is a named channel for ",(0,i.jsx)(n.strong,{children:"asynchronous, one-way"})," message distribution. Think of it as a bulletin board where:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Publishers"})," post messages to the topic"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Subscribers"})," listen and receive copies of those messages"]}),"\n",(0,i.jsx)(n.li,{children:"Multiple publishers can write to the same topic"}),"\n",(0,i.jsx)(n.li,{children:"Multiple subscribers can read from the same topic"}),"\n",(0,i.jsx)(n.li,{children:"Publishers and subscribers don't need to know about each other"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),": A humanoid robot's joint position publisher continuously broadcasts the current angle of each joint. Any node interested in joint positions\u2014the planner, the safety monitor, the data logger\u2014can subscribe without the publisher knowing or caring."]}),"\n",(0,i.jsx)(n.h3,{id:"pub-sub-communication-flow",children:"Pub-Sub Communication Flow"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Publisher (e.g., Joint State Sensor)\r\n         \u2193\r\n    Topic: /robot/joint_states\r\n         \u2199      \u2193      \u2198\r\n    Planner  Monitor  Logger\r\n   (Subscriber 1) (Subscriber 2) (Subscriber 3)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key advantages of pub-sub"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Decoupling"}),": Publishers and subscribers are independent; new subscribers can join at any time"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scalability"}),": One publisher can serve many subscribers with minimal overhead"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Asynchronous"}),": Senders don't wait for receivers to process; messages are queued"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"message-types-and-examples",children:"Message Types and Examples"}),"\n",(0,i.jsx)(n.p,{children:"ROS 2 defines standardized message types for common robotics tasks:"}),"\n",(0,i.jsx)(n.h4,{id:"sensor_msgsjointstate",children:(0,i.jsx)(n.strong,{children:"sensor_msgs/JointState"})}),"\n",(0,i.jsx)(n.p,{children:"Published by joint sensors or state estimators. Contains joint positions, velocities, and efforts."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# Structure\r\nheader:\r\n  seq: 1\r\n  stamp:\r\n    sec: 1702881234\r\n    nsec: 567890123\r\n  frame_id: "robot_base"\r\nname: ["shoulder_pan", "shoulder_lift", "elbow_flex", "wrist_1", "wrist_2", "wrist_3"]\r\nposition: [0.0, 1.57, -1.57, 0.0, 0.0, 0.0]      # Radians\r\nvelocity: [0.1, 0.05, -0.08, 0.0, 0.0, 0.0]      # Rad/sec\r\neffort: [10.5, 15.2, 8.3, 0.0, 0.0, 0.0]         # Nm (Newton-meters)\n'})}),"\n",(0,i.jsx)(n.h4,{id:"geometry_msgstwist",children:(0,i.jsx)(n.strong,{children:"geometry_msgs/Twist"})}),"\n",(0,i.jsx)(n.p,{children:"Published by motion planners to specify desired robot velocities (linear and angular)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# Structure for mobile manipulation (e.g., Spot, HSR)\r\nlinear:\r\n  x: 0.5      # Forward velocity (m/s)\r\n  y: 0.0      # Strafe velocity (m/s)\r\n  z: 0.0      # Vertical velocity (m/s)\r\nangular:\r\n  x: 0.0      # Roll rate (rad/s)\r\n  y: 0.0      # Pitch rate (rad/s)\r\n  z: 0.1      # Yaw rate (rad/s)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"sensor_msgsimage",children:(0,i.jsx)(n.strong,{children:"sensor_msgs/Image"})}),"\n",(0,i.jsx)(n.p,{children:"Published by cameras. Contains pixel data, encoding, and metadata."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# Structure\r\nheader: {seq: 42, stamp: {...}, frame_id: "camera_link"}\r\nheight: 480\r\nwidth: 640\r\nencoding: "rgb8"\r\nis_bigendian: false\r\nstep: 1920                    # Bytes per row\r\ndata: [255, 128, 64, ...]     # Raw pixel data\n'})}),"\n",(0,i.jsx)(n.h4,{id:"geometry_msgsposestamped",children:(0,i.jsx)(n.strong,{children:"geometry_msgs/PoseStamped"})}),"\n",(0,i.jsx)(n.p,{children:"Published by perception systems to indicate detected object positions and orientations."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# Structure\r\nheader: {seq: 1, stamp: {...}, frame_id: "camera_optical_frame"}\r\npose:\r\n  position:\r\n    x: 0.5      # Position in 3D space (meters)\r\n    y: 0.2\r\n    z: 1.1\r\n  orientation:\r\n    x: 0.0      # Quaternion (x, y, z, w)\r\n    y: 0.0\r\n    z: 0.707\r\n    w: 0.707\n'})}),"\n",(0,i.jsx)(n.h3,{id:"quality-of-service-qos-policies",children:"Quality of Service (QoS) Policies"}),"\n",(0,i.jsxs)(n.p,{children:["ROS 2 allows publishers and subscribers to specify ",(0,i.jsx)(n.strong,{children:"Quality-of-Service (QoS) policies"})," that affect message delivery:"]}),"\n",(0,i.jsx)(n.h4,{id:"reliability-policy",children:(0,i.jsx)(n.strong,{children:"Reliability Policy"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RELIABLE"}),": Every message is guaranteed to be delivered (may introduce latency)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"BEST_EFFORT"}),": Messages may be lost if the network is congested (lower latency)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"When to use"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"RELIABLE: Critical messages (grasp commands, emergency stop)"}),"\n",(0,i.jsx)(n.li,{children:"BEST_EFFORT: High-frequency sensor data (camera frames, IMU readings)"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"durability-policy",children:(0,i.jsx)(n.strong,{children:"Durability Policy"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"VOLATILE"}),": Messages only available to current subscribers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"TRANSIENT_LOCAL"}),": New subscribers receive the last message (useful for configuration data)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Publish robot configuration with TRANSIENT_LOCAL QoS\r\nqos_policy = QoSProfile(reliability=ReliabilityPolicy.RELIABLE,\r\n                        durability=DurabilityPolicy.TRANSIENT_LOCAL)\r\nself.config_publisher = self.create_publisher(\r\n    RobotConfig, '/robot/config', qos_profile=qos_policy)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"history-policy",children:(0,i.jsx)(n.strong,{children:"History Policy"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"KEEP_LAST(n)"}),": Store only the last n messages (default: n=1)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"KEEP_ALL"}),": Store all messages until consumed"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Trade-off"}),": KEEP_ALL uses more memory but ensures no message loss; KEEP_LAST is memory-efficient but may drop old messages if subscribers are slow."]}),"\n",(0,i.jsx)(n.h3,{id:"topic-naming-conventions",children:"Topic Naming Conventions"}),"\n",(0,i.jsx)(n.p,{children:"Standardize your topic names for clarity and to avoid conflicts:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"/robot/<component>/<data_type>\r\n\r\nExamples:\r\n/robot/arm/joint_states          # Joint positions/velocities\r\n/robot/gripper/command           # Gripper open/close signal\r\n/robot/camera/rgb/image_raw      # Camera RGB stream\r\n/robot/imu/data                  # IMU acceleration and rotation\r\n/robot/navigation/goal           # Navigation target\r\n/robot/safety/emergency_stop     # Critical safety signal\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"services-and-request-reply-communication",children:"Services and Request-Reply Communication"}),"\n",(0,i.jsx)(n.h3,{id:"what-is-a-service",children:"What is a Service?"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"service"})," is a ",(0,i.jsx)(n.strong,{children:"synchronous, request-reply"})," mechanism. A client sends a request and waits for a response:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Client (e.g., Planning Node)\r\n    \u2193 (sends request)\r\nService Server (e.g., Grasp Planner)\r\n    \u2193 (processes request)\r\n    \u2191 (sends response)\r\nClient receives response\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key differences from pub-sub"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Synchronous"}),": Client blocks until the server responds"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"One-to-one"}),": Each request goes to one specific server"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Bidirectional"}),": Information flows both ways"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"service-request-reply-patterns",children:"Service Request-Reply Patterns"}),"\n",(0,i.jsx)(n.h4,{id:"pattern-1-query-information",children:(0,i.jsx)(n.strong,{children:"Pattern 1: Query Information"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Request: "What is the current joint configuration?"\r\nResponse: [0.0, 1.57, -1.57, 0.0, 0.0, 0.0]\n'})}),"\n",(0,i.jsx)(n.h4,{id:"pattern-2-perform-an-action",children:(0,i.jsx)(n.strong,{children:"Pattern 2: Perform an Action"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Request: "Plan a grasp at position (0.5, 0.2, 1.1) with orientation Q"\r\nResponse: { success: true, trajectory: [...], duration: 2.3 }\n'})}),"\n",(0,i.jsx)(n.h4,{id:"pattern-3-enabledisable-functionality",children:(0,i.jsx)(n.strong,{children:"Pattern 3: Enable/Disable Functionality"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Request: "Enable collision avoidance"\r\nResponse: { success: true, message: "Collision avoidance enabled" }\n'})}),"\n",(0,i.jsx)(n.h3,{id:"service-definition-example",children:"Service Definition Example"}),"\n",(0,i.jsxs)(n.p,{children:["Services are defined in ",(0,i.jsx)(n.code,{children:".srv"})," files (ROS 2 Interface Definition Language):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# GraspPlanning.srv\r\n# Request\r\ngeometry_msgs/PoseStamped target_pose\r\nstring gripper_type\r\n---\r\n# Response\r\nbool success\r\ntrajectory_msgs/JointTrajectory planned_trajectory\r\nfloat32 execution_time_sec\r\nstring error_message\n"})}),"\n",(0,i.jsx)(n.p,{children:"A client calls this service like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'grasp_client.call_async(GraspPlanning.Request(\r\n    target_pose=pose_stamped,\r\n    gripper_type="parallel_gripper"))\n'})}),"\n",(0,i.jsx)(n.h3,{id:"when-to-use-services-vs-topics",children:"When to Use Services vs. Topics"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Use Service"}),(0,i.jsx)(n.th,{children:"Use Topic"}),(0,i.jsx)(n.th,{children:"Reason"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Stream camera frames at 30 Hz"}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"Continuous, asynchronous data; latency-tolerant"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Publish joint positions every 10 ms"}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"High-frequency updates; subscribers decide consumption rate"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Request a grasp plan for an object"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"Synchronous request; client needs answer before proceeding"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Emergency stop signal"}),(0,i.jsx)(n.td,{children:"\u2705 or \u2705"}),(0,i.jsx)(n.td,{children:"Both work; use service for critical, latency-sensitive commands"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Log sensor data for analysis"}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"Passive consumption; no response needed"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Check if gripper is gripping"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"Query current state; expect immediate response"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Decision rule"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use a service if"})," the caller needs a response before proceeding (request-reply semantics)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use a topic if"})," the sender doesn't need acknowledgment or if there are multiple subscribers (pub-sub semantics)"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"practical-context-communication-in-humanoid-robots",children:"Practical Context: Communication in Humanoid Robots"}),"\n",(0,i.jsx)(n.h3,{id:"example-1-obstacle-detection-pipeline",children:"Example 1: Obstacle Detection Pipeline"}),"\n",(0,i.jsx)(n.p,{children:"A humanoid robot detects obstacles in front of it and adjusts its walking path."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Perception Layer:\r\n  Camera Publisher \u2192 /robot/camera/rgb/image_raw (topic)\r\n  Obstacle Detector Node (subscriber)\r\n         \u2193\r\n    Process image, detect obstacles\r\n         \u2193\r\n  Publish Obstacles \u2192 /robot/perception/obstacles (topic)\r\n\r\nPlanning Layer:\r\n  Path Planner Node (subscriber to /robot/perception/obstacles)\r\n         \u2193\r\n    Compute collision-free path\r\n         \u2193\r\n  Publish Planned Trajectory \u2192 /robot/planning/trajectory (topic)\r\n\r\nAction Layer:\r\n  Motor Controller Node (subscriber to /robot/planning/trajectory)\r\n         \u2193\r\n    Execute joint commands\r\n         \u2193\r\n  Publish Joint States \u2192 /robot/arm/joint_states (topic)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Why topics?"})," All data is continuous, asynchronous, and decoupled. The camera doesn't know about obstacles; the planner doesn't know about the camera\u2014they're independent subsystems."]}),"\n",(0,i.jsx)(n.h3,{id:"example-2-grasp-command-pipeline",children:"Example 2: Grasp Command Pipeline"}),"\n",(0,i.jsx)(n.p,{children:"A humanoid reaches for an object and grasps it. The grasping command is synchronous\u2014the arm waits for grasp confirmation."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'User/AI Agent:\r\n  "Grasp object at (0.5, 0.2, 1.1)" \u2192 Service Call\r\n         \u2193\r\nGrasp Planning Service Server:\r\n  Inverse kinematics calculation\r\n  Collision checking\r\n  Trajectory generation\r\n         \u2193\r\n  Returns: {success: true, trajectory: [...]}\r\n         \u2193\r\nMotor Controller subscribes to /robot/arm/planned_trajectory\r\n  Executes joint commands\r\n         \u2193\r\nPublishes /robot/arm/joint_states (continuous feedback)\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Why a service for grasp planning?"})," The AI agent needs confirmation that the grasp is feasible before committing to the action. If the service returns ",(0,i.jsx)(n.code,{children:"success: false"}),", the agent can retry with a different pose."]}),"\n",(0,i.jsx)(n.h3,{id:"example-3-motor-feedback-loop",children:"Example 3: Motor Feedback Loop"}),"\n",(0,i.jsx)(n.p,{children:"A humanoid's arm controller continuously receives joint position feedback."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Joint Sensor Publisher:\r\n  Publishes every 10 ms \u2192 /robot/arm/joint_states\r\n         \u2193 (asynchronous)\r\n  Subscribers:\r\n    - Safety Monitor (checks if joints are in safe range)\r\n    - Motor Controller (reads current state for next command)\r\n    - Data Logger (records for analysis)\r\n         \u2193\r\n  No blocking; all subscribers consume at their own pace\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Why topics?"})," Continuous feedback stream with multiple independent consumers."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"communication-patterns-in-humanoids",children:"Communication Patterns in Humanoids"}),"\n",(0,i.jsx)(n.h3,{id:"pattern-1-perception--planning--action",children:"Pattern 1: Perception \u2192 Planning \u2192 Action"}),"\n",(0,i.jsx)(n.p,{children:"The classic three-layer architecture for robot control:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502                    Humanoid Robot System                     \u2502\r\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\r\n\u2502                                                               \u2502\r\n\u2502  PERCEPTION LAYER:                                           \u2502\r\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\r\n\u2502  \u2502 Camera Pub  Depth Pub  IMU Pub   Force/Torque Pub   \u2502   \u2502\r\n\u2502  \u2502     \u2193           \u2193         \u2193            \u2193             \u2502   \u2502\r\n\u2502  \u2502 Obstacle Detector, Object Recognizer, Localization  \u2502   \u2502\r\n\u2502  \u2502     \u2193                          \u2193                     \u2502   \u2502\r\n\u2502  \u2502 Obstacles Topic \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192  Object Poses Topic      \u2502   \u2502\r\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\r\n\u2502                                   \u2193                          \u2502\r\n\u2502  PLANNING LAYER:                                            \u2502\r\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\r\n\u2502  \u2502 Path Planner      Motion Planner     Grasp Planner   \u2502   \u2502\r\n\u2502  \u2502 (service calls)   (service calls)    (service calls) \u2502   \u2502\r\n\u2502  \u2502     \u2193                 \u2193                  \u2193           \u2502   \u2502\r\n\u2502  \u2502 Trajectory Topic \u2190\u2500 Trajectory Topic \u2190 Trajectory    \u2502   \u2502\r\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\r\n\u2502                                   \u2193                          \u2502\r\n\u2502  ACTION LAYER:                                              \u2502\r\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\r\n\u2502  \u2502 Motor Controllers (subscribes to Trajectory Topic)   \u2502   \u2502\r\n\u2502  \u2502     \u2193                                                \u2502   \u2502\r\n\u2502  \u2502 Publish Joint Commands \u2500\u2192 Actuators                 \u2502   \u2502\r\n\u2502  \u2502 Publish Joint Feedback \u2190\u2500 Joint Sensors             \u2502   \u2502\r\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\r\n\u2502                                                               \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Data flow"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Sensors publish raw data to topics (camera, IMU, force-torque)"}),"\n",(0,i.jsx)(n.li,{children:"Perception nodes subscribe, process, and publish interpreted data (obstacles, objects)"}),"\n",(0,i.jsx)(n.li,{children:"Planning nodes subscribe to perception data, call services for feasibility checks, and publish trajectories"}),"\n",(0,i.jsx)(n.li,{children:"Action nodes subscribe to trajectories and execute commands"}),"\n",(0,i.jsx)(n.li,{children:"Feedback loops: Controllers publish joint states; planners subscribe to verify execution"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"pattern-2-multi-agent-coordination",children:"Pattern 2: Multi-Agent Coordination"}),"\n",(0,i.jsx)(n.p,{children:"Two robots must coordinate actions without collision:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Robot 1:\r\n  Motion Planner \u2192 /shared/robot_1/trajectory (topic)\r\n                      \u2193\r\n              Shared Namespace\r\n\r\nRobot 2:\r\n  Motion Planner \u2192 /shared/robot_2/trajectory (topic)\r\n                      \u2193\r\n              Shared Namespace\r\n                      \u2193\r\n  Coordination Service (requests all robot trajectories, checks collisions)\r\n    If collision detected \u2192 respond with adjusted trajectories\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Pattern"}),": Each robot publishes its planned trajectory to a shared namespace. A coordination service aggregates all trajectories, checks for collisions, and responds with adjusted plans if conflicts are detected."]}),"\n",(0,i.jsx)(n.h3,{id:"pattern-3-hierarchical-control-with-mode-switching",children:"Pattern 3: Hierarchical Control with Mode Switching"}),"\n",(0,i.jsx)(n.p,{children:"Robot operates in different modes (idle, walking, grasping, manipulating):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"User Input / AI Decision\r\n       \u2193\r\n  Mode Selector Service\r\n  \u251c\u2500 IDLE \u2192 Disable all motion controllers\r\n  \u251c\u2500 WALKING \u2192 Activate leg controllers, subscribe to walking target\r\n  \u251c\u2500 GRASPING \u2192 Activate arm controller, subscribe to grasp target\r\n  \u2514\u2500 MANIPULATION \u2192 Activate arm + gripper, coordinate movement\r\n\r\nCurrent Mode Topic: /robot/mode\r\n  \u2193 (all controllers subscribe)\r\n     Controllers adjust behavior based on mode\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Benefit"}),": Clean separation of concerns. Each controller only responds to its mode, reducing complexity."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"edge-cases-and-synchronization",children:"Edge Cases and Synchronization"}),"\n",(0,i.jsx)(n.h3,{id:"challenge-1-node-failures-and-recovery",children:"Challenge 1: Node Failures and Recovery"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scenario"}),": A perception node crashes. Planning and action nodes are waiting for data."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Perception Node CRASHES \u2717\r\n       \u2193\r\nPerception Topic (/robot/perception/obstacles) stops receiving data\r\n       \u2193\r\nPlanner timeout \u2192 Planning fails \u2192 Action blocked\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Timeout handling"}),": Set explicit timeouts on topic subscriptions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fallback behavior"}),": If no perception data for 500 ms, use last known state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Health monitoring"}),": Launch a dedicated monitoring node that checks heartbeats from critical nodes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Graceful degradation"}),": Continue with conservative assumptions (assume obstacles everywhere)"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Pseudocode for timeout handling\r\nlast_obstacle_data = None\r\nlast_update_time = time.now()\r\n\r\nwhile True:\r\n    if (time.now() - last_update_time) > 0.5:  # 500 ms timeout\r\n        # No data received; use fallback\r\n        apply_conservative_behavior()\r\n    else:\r\n        # Data available; process normally\r\n        plan_with_current_data()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"challenge-2-message-delays-and-out-of-order-delivery",children:"Challenge 2: Message Delays and Out-of-Order Delivery"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scenario"}),": Two camera images arrive out of order due to network delays. Image B (newer) arrives before Image A (older)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Time:  0 ms    10 ms    20 ms    30 ms    40 ms\r\nSent:  Image A \u2500\u2500\u2500\u2500\u2500\u2192   Image B \u2500\u2500\u2500\u2500\u2500\u2192\r\nRecv:  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192   \u2190\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n       (Image B arrives first!)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Timestamping"}),": Every message includes a ",(0,i.jsx)(n.code,{children:"header.stamp"})," (ROS Time)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sorting by timestamp"}),": Process messages in the order of their sensor timestamp, not arrival order"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Message synchronization"}),": Use message_filters to synchronize messages from multiple sensors"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Use ROS 2 message_filters to synchronize camera and depth\r\nfrom message_filters import ApproximateTimeSynchronizer\r\n\r\nsync = ApproximateTimeSynchronizer(\r\n    [camera_sub, depth_sub],\r\n    queue_size=10,\r\n    slop=0.1)  # 100 ms tolerance\r\nsync.registerCallback(on_image_and_depth)\r\n\r\ndef on_image_and_depth(image_msg, depth_msg):\r\n    # Both messages are approximately synchronized\r\n    process_stereo_pair(image_msg, depth_msg)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"challenge-3-conflicting-commands-multi-agent-coordination",children:"Challenge 3: Conflicting Commands (Multi-Agent Coordination)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scenario"}),": Two planning nodes both issue grasp commands to the same gripper."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Planner 1: "Open gripper"  \u2500\u2500\u2510\r\n                              \u251c\u2500\u2192 Gripper Controller\r\nPlanner 2: "Close gripper" \u2500\u2500\u2518\r\n       \u2193 (conflict!)\r\nWhich command wins?\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Single writer principle"}),': Only one node can write commands to a topic (the "master controller")']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service-based arbitration"}),": Planners call a service; the service enforces mutual exclusion"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Command queuing"}),": Queue commands and execute sequentially, or reject conflicting commands"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Service-based arbitration\r\nclass GraspArbitrator:\r\n    def handle_grasp_request(self, request):\r\n        if self.gripper_in_use:\r\n            return Response(success=False, message="Gripper busy")\r\n        self.gripper_in_use = True\r\n        self.issue_grasp_command(request)\r\n        self.gripper_in_use = False\r\n        return Response(success=True)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"challenge-4-latency-critical-tasks",children:"Challenge 4: Latency-Critical Tasks"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scenario"}),": Emergency stop signal must reach the motor controller within 50 ms."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Safety Monitor detects obstacle\r\n       \u2193\r\nPublish /robot/safety/emergency_stop\r\n       \u2193 (network delay, queue delay, processing delay)\r\nMotor Controller receives signal (50 ms deadline)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"High-priority QoS"}),": Set reliability=RELIABLE and priority=HIGH"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dedicated channel"}),": Use a separate, lower-latency topic for critical signals"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Redundant communication"}),": Send emergency stop on both ROS 2 topic and a hardwired interrupt line"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# High-priority emergency stop\r\nqos_policy = QoSProfile(\r\n    reliability=ReliabilityPolicy.RELIABLE,\r\n    durability=DurabilityPolicy.VOLATILE,\r\n    history=HistoryPolicy.KEEP_LAST(1),\r\n    deadline=Duration(milliseconds=50))\r\nemergency_pub = self.create_publisher(\r\n    EmergencyStop, '/robot/safety/emergency_stop',\r\n    qos_profile=qos_policy)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"challenge-5-bandwidth-constraints",children:"Challenge 5: Bandwidth Constraints"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Scenario"}),": A humanoid is transmitting camera video (30 MB/s) and joint states (1 kB/s) over a 100 Mbps network."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Total bandwidth needed: 30 MB/s + overhead > 100 Mbps available\r\n       \u2193\r\nNetwork congestion \u2192 messages dropped \u2192 control instability\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Compression"}),": Compress video with H.264 codec; publish JPEG instead of raw RGB"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Frequency adaptation"}),": Lower publication rate for non-critical data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Lossy QoS"}),": Use BEST_EFFORT for high-bandwidth data (camera); RELIABLE for critical data (grasp commands)"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Publish compressed video instead of raw frames\r\nself.compressed_image_pub = self.create_publisher(\r\n    CompressedImage, '/robot/camera/rgb/image_raw/compressed',\r\n    qos_profile=QoSProfile(reliability=ReliabilityPolicy.BEST_EFFORT))\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"ROS 2 communication is built on two fundamental patterns:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Topics (Pub-Sub)"}),": Asynchronous, one-way message distribution. Use for continuous sensor data, decoupled subsystems, and scenarios with multiple subscribers."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Services (Request-Reply)"}),": Synchronous, bidirectional communication. Use for queries, synchronous operations, and scenarios where the caller needs a response before proceeding."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key takeaways"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Nodes are independent computational units communicating via topics and services"}),"\n",(0,i.jsxs)(n.li,{children:["Design your communication topology using the ",(0,i.jsx)(n.strong,{children:"Perception \u2192 Planning \u2192 Action"})," pattern"]}),"\n",(0,i.jsx)(n.li,{children:"Use Quality-of-Service policies to ensure reliable, low-latency communication for time-critical tasks"}),"\n",(0,i.jsx)(n.li,{children:"Handle edge cases (node failures, delays, conflicts) with timeouts, fallback behavior, and arbitration mechanisms"}),"\n",(0,i.jsx)(n.li,{children:"Balance bandwidth, latency, and reliability based on your humanoid's requirements"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Next chapter"}),": Learn how to implement these communication patterns in Python using rclpy."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"review-questions",children:"Review Questions"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What is the primary difference between a topic and a service in ROS 2?"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Design a communication topology for a humanoid robot that needs to:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Detect obstacles"})," using a camera and Lidar"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Plan a grasp"})," for an object"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Execute the grasp"})," with the gripper"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Which nodes would you create? Which would use topics, and which would use services?"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Explain when you would use RELIABLE vs. BEST_EFFORT QoS policies. Give two examples for each."})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"A humanoid robot publishes joint states at 100 Hz. Three different nodes subscribe to this data:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The motion controller (needs updates every 10 ms)"}),"\n",(0,i.jsx)(n.li,{children:"The data logger (records for offline analysis)"}),"\n",(0,i.jsx)(n.li,{children:"The safety monitor (checks for anomalies every 100 ms)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Why is pub-sub the right choice here, not services?"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"What is the node lifecycle in ROS 2, and why is it important for robot control?"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Describe a scenario where an emergency stop signal must be delivered in under 50 ms. How would you ensure this latency guarantee?"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Two planning nodes both try to command the same gripper to open and close simultaneously. What communication pattern would you use to resolve this conflict?"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Explain the role of the ",(0,i.jsx)(n.code,{children:"header.stamp"})," field in ROS 2 messages. Why is it critical for multi-sensor fusion?"]})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"A sensor publishes at 30 Hz, but due to network delays, messages sometimes arrive out of order. How would you ensure your processing code handles this correctly?"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Design a simple Perception \u2192 Planning \u2192 Action pipeline for a humanoid robot that navigates to and picks up an object. For each component, specify whether it publishes topics, calls services, or both."})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:'What does "Quality of Service" (QoS) mean in ROS 2? Name three QoS policies and explain their trade-offs.'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"A humanoid robot receives a high-bandwidth video stream (30 MB/s) over a 100 Mbps network link. Propose three strategies to stay within bandwidth limits without losing critical functionality."})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Explain why multi-agent robots need a ",(0,i.jsx)(n.strong,{children:"shared namespace"})," for their communication topics. Give an example."]})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["What is the difference between ",(0,i.jsx)(n.code,{children:"TRANSIENT_LOCAL"})," and ",(0,i.jsx)(n.code,{children:"VOLATILE"})," durability in QoS? When would you use each?"]})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"A planning node times out waiting for perception data. Design a fallback strategy that allows the robot to continue operating safely."})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/Basic/About-Nodes.html",children:"ROS 2 Humble Documentation: Nodes"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/Basic/About-Topics.html",children:"ROS 2 Humble Documentation: Topics"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/Basic/About-Services.html",children:"ROS 2 Humble Documentation: Services"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/Intermediate/About-Quality-of-Service-Settings.html",children:"ROS 2 Quality of Service Policies"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/ros2/common_interfaces",children:"Standard ROS 2 Message Types"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>l});var r=s(6540);const i={},o=r.createContext(i);function t(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);